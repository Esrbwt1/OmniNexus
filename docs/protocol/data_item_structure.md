# Standard Data Item Structure

The OmniNexus Protocol (ONP) defines a standard structure for individual data items passed between components, primarily from Connectors to Agents via the Orchestrator. Adhering to this structure ensures consistency and allows Agents to process data from diverse sources more reliably.

Each data item is represented as a Python dictionary containing the following top-level keys:

## Top-Level Keys

*   `item_id` (str)
    *   Description: A unique identifier generated by the Connector *for this specific instance* of fetching the data item. This helps distinguish between multiple retrievals of potentially the same source data over time.
    *   Implementation: Typically generated using protocol.generate_item_id() (which uses uuid.uuid4()).
    *   Required: Yes

*   `connector_id` (str)
    *   Description: The unique ID assigned to the specific *instance* of the Connector that retrieved this data item (e.g., my_local_docs, my_real_email). This allows tracing data back to its configured source.
    *   Implementation: Provided by the Orchestrator when the Connector instance is created; the Connector includes it in the data item.
    *   Required: Yes

*   `source_uri` (str)
    *   Description: A Uniform Resource Identifier (URI) that represents the original location or identifier of the data at its source. The URI scheme depends on the Connector type.
    *   Examples:
        *   Local Files: file:///C:/Users/User/Documents/report.txt (or file:///home/user/report.txt)
        *   IMAP Email: imap://user@example.com@imap.example.com/INBOX;UID=12345
        *   Web Page (Future): https://example.com/article
    *   Required: Yes

*   `retrieved_at` (str)
    *   Description: An ISO 8601 formatted timestamp string (including timezone information, typically UTC) indicating when the Connector fetched this data item.
    *   Implementation: Typically generated using protocol.create_iso_timestamp().
    *   Required: Yes

*   `metadata` (dict)
    *   Description: A dictionary containing metadata *about the source data itself*, provided by the Connector. The keys within this dictionary are specific to the data type and Connector.
    *   Common Keys (Examples):
        *   type (str): A hint about the data type, often a MIME type (e.g., text/plain, text/markdown, message/rfc822, image/jpeg).
        *   filename (str): Original filename, if applicable.
        *   created_time (str): ISO 8601 timestamp of source creation time, if available.
        *   modified_time (str): ISO 8601 timestamp of source modification time, if available.
        *   size_bytes (int): Size of the source data in bytes, if applicable.
        *   encoding (str): Text encoding, if applicable (e.g., utf-8).
        *   uid (str): Source-specific unique ID (e.g., IMAP UID).
        *   mailbox (str): Source mailbox (for email).
        *   message_id (str): RFC standard email Message-ID header.
        *   *(Connector-specific keys...)*
    *   Required: Yes (The dictionary itself is required, though it might be sparsely populated depending on the source).

*   `payload` (dict)
    *   Description: A dictionary containing the actual *content* of the data item. The structure of this dictionary depends on the data type.
    *   Key Convention: For data that has a primary textual representation (like files, email bodies), the key `content` (str) should be used to hold that text. This provides a standard key for text-processing Agents to look for.
    *   Other Payload Keys (Examples):
        *   Email Headers: subject, from, to, cc, date_str.
        *   Email Body: body_text (plain text), body_html (future).
        *   Structured Data: Keys corresponding to fields (e.g., event_title, start_time for calendar items - future).
        *   Files: The content key usually holds the file's text content. For binary files (future), it might hold bytes or a reference.
    *   Required: Yes (The dictionary itself is required). The presence of specific keys like content depends on the Connector and the data item. Agents need to handle potentially missing keys gracefully.

## Example: Local File Data Item

{
  "item_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "connector_id": "my_notes",
  "source_uri": "file:///home/user/notes/meeting_prep.md",
  "retrieved_at": "2025-05-05T10:30:00.123456+00:00",
  "metadata": {
    "type": "text/markdown",
    "filename": "meeting_prep.md",
    "created_time": "2025-05-04T09:00:00+00:00",
    "modified_time": "2025-05-05T10:25:00+00:00",
    "size_bytes": 1578,
    "encoding": "utf-8",
    "full_path": "/home/user/notes/meeting_prep.md"
  },
  "payload": {
    "content": "# Meeting Prep\\n\\n## Agenda\\n\\n- Discuss project status\\n- Review metrics..."
  }
}

## Example: IMAP Email Header Data Item (Previous Version)
(Note: The current IMAP connector fetches the full body, see next example)

{
  "item_id": "f0e9d8c7-b6a5-4321-fedc-ba9876543210",
  "connector_id": "work_email",
  "source_uri": "imap://user@work.com@imap.work.com/INBOX;UID=987",
  "retrieved_at": "2025-05-05T11:00:00.987654+00:00",
  "metadata": {
    "type": "message/rfc822-headers",
    "uid": "987",
    "mailbox": "INBOX"
  },
  "payload": {
    "subject": "Project Update Required",
    "from": "Boss <boss@work.com>",
    "date_str": "Mon, 5 May 2025 10:59:00 +0000"
  }
}

## Example: IMAP Email Data Item (Current - with Body)

{
  "item_id": "f0e9d8c7-b6a5-4321-fedc-ba9876543210",
  "connector_id": "work_email",
  "source_uri": "imap://user@work.com@imap.work.com/INBOX;UID=987",
  "retrieved_at": "2025-05-05T11:00:00.987654+00:00",
  "metadata": {
    "type": "message/rfc822",
    "uid": "987",
    "mailbox": "INBOX",
    "message_id": "<unique-id-string@mailer.work.com>"
  },
  "payload": {
    "subject": "Project Update Required",
    "from": "Boss <boss@work.com>",
    "to": "Me <user@work.com>",
    "cc": null,
    "date_str": "Mon, 5 May 2025 10:59:00 +0000",
    "content": "Hi User,\\n\\nPlease provide the status update by EOD.\\n\\nThanks,\\nBoss",
    "body_text": "Hi User,\\n\\nPlease provide the status update by EOD.\\n\\nThanks,\\nBoss"
  }
}